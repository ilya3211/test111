!function(e){"function"==typeof define&&define.amd?define("tinymce",e):e()}((function(){"use strict";jQuery((function(e){var r=expert_review_globals.i18n,t=function(){this.items=[],this._loaded=!1};t.prototype._populate=function(){var r=e(this.selector);r.empty(),this.items.forEach((function(e){r.append('<option value="'+e.id+'">'+e.name+"</option>")}))},t.prototype.load=function(r){var t=this;this._loaded?(t._populate(),r()):e.ajax({url:expert_review_globals.url,type:"post",data:{action:t._action,nonce:expert_review_globals.nonce}}).done((function(e){e.success&&(t.items=e.data.items,t._populate())})).always((function(){t._loaded=!0,r()}))};var i=function(){this._action="expert_review_load_users",this.selector=".js-mce-expert-review-expert-users select"};(i.prototype=t.prototype).constructor=t;var c=function(){this._action="expert_review_load_experts",this.selector=".js-mce-expert-review-expert-experts select"};(c.prototype=t.prototype).constructor=t;var s=new i,p=new c;function v(e,r){return(r=void 0===r||r)?function(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br>")}(l(e)):l(e)}function l(e){return e.replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/&/g,"&amp;")}e(document).on("click",".js-mce-expert-review-header",(function(){e(this).next(".js-mce-expert-review-section").slideToggle()})),e(document).on("change",".js-mce-expert-review-type",(function(){var r=e(this),t=e(".js-mce-expert-review-expert-avatar"),i=e(".js-mce-expert-review-expert-name"),c=e(".js-mce-expert-review-expert-experts"),v=e(".js-mce-expert-review-expert-users");switch(r.prop("disabled",!0),r.val()){case"user_id":t.hide(),i.hide(),c.hide(),v.show(),s.load((function(){r.prop("disabled",!1)}));break;case"expert_id":t.hide(),i.hide(),v.hide(),c.show(),p.load((function(){r.prop("disabled",!1)}));break;default:t.show(),i.show(),c.hide(),v.hide(),r.prop("disabled",!1)}})),e(document).on("click",".js-mce-expert-review-color",(function(){var r=e(this),t=r.data("color"),i=e(".js-mce-expert-review-color-field");if(r.hasClass("active"))return r.removeClass("active"),i.val(""),!1;e(".js-mce-expert-review-color").removeClass("active"),r.addClass("active"),i.val(t)})),e(document).on("click",".js-mce-expert-review-qa-add",(function(){var r=e(this).parent().parent().find(".js-mce-expert-review-qa-list"),t=r.find(".js-mce-expert-review-qa-item").last().clone();return t.find("textarea").val(""),r.append(t),!1})),e(document).on("click",".js-mce-expert-review-qa-remove",(function(){var r=e(this).parents(".js-mce-expert-review-qa-item");r.parent().find(".js-mce-expert-review-qa-item").length>1?r.remove():r.find("textarea").val("")})),e(document).on("click",".js-mce-expert-review-score-line-add",(function(){e(this);var r=e(".js-mce-expert-review-score-lines"),t=r.find(".js-mce-expert-review-score-line:last").clone();return t.find("input").val(""),r.append(t),!1})),e(document).on("click",".js-mce-expert-review-score-line-remove",(function(){var r=e(this).parents(".js-mce-expert-review-score-line");e(".js-mce-expert-review-score-line").length>1?r.remove():r.find("input").val("")})),e(document).on("click",".js-mce-expert-review-plus-minus-add",(function(){var r=e(this).parent().parent().find(".js-mce-expert-review-pluses-minuses-container"),t=r.find(".js-mce-expert-review-plus,.js-mce-expert-review-minus").last().clone();return t.find("input").val(""),r.append(t),!1})),e(document).on("click",".js-mce-expert-review-plus-minus-remove",(function(){var r=e(this).parents(".js-mce-expert-review-plus,.js-mce-expert-review-minus");r.parent().find(".js-mce-expert-review-plus,.js-mce-expert-review-minus").length>1?r.remove():r.find("input").val("")})),tinymce.create("tinymce.plugins.expert_review_button",{init:function(t,i){t.addButton("expert_review_button",{title:"Expert Review",image:expert_review_globals.editor_icon,onclick:function(){t.selection.getContent({format:"html"});var i=e(window).height()-200,c='<div class="mce-expert-review">  <div class="mce-expert-review-colors">  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--purple-1" data-color="purple-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--blue-1" data-color="blue-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--blue-2" data-color="blue-2"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--pink-1" data-color="pink-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--red-1" data-color="red-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--orange-1" data-color="orange-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--green-1" data-color="green-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--green-2" data-color="green-2"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--gray-1" data-color="gray-1"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--gray-2" data-color="gray-2"></div>  <div class="mce-expert-review-color js-mce-expert-review-color mce-expert-review-color--black-1" data-color="black-1"></div>  </div>  <input type="hidden" class="js-mce-expert-review-color-field">  <div class="mce-expert-review-header js-mce-expert-review-header">'+r.expert+'</div>  <div class="mce-expert-review-section js-mce-expert-review-section">  <div class="mce-expert-review-expert">    <div class="mce-expert-review-form js-mce-expert-review-expert-type">      <label class="mce-expert-review-form-label">Эксперт</label>      <div class="mce-expert-review-form-field">        <div>          <select class="js-mce-expert-review-type">            <option value="self">Указать вручную</option>            <option value="user_id">Выбрать из пользователей</option>            <option value="expert_id">Выбрать из экспертов</option>          </select>        </div>      </div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-avatar">      <label class="mce-expert-review-form-label" for="mce-expert-review-expert-avatar">URL аватарки</label>      <div class="mce-expert-review-form-field"><input id="mce-expert-review-expert-avatar" type="text"></div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-name">      <label class="mce-expert-review-form-label" for="mce-expert-review-expert-name">Имя</label>      <div class="mce-expert-review-form-field"><input id="mce-expert-review-expert-name" type="text"></div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-experts" style="display: none;">      <label class="mce-expert-review-form-label" for="mce-expert-review-expert-experts">Эксперты</label>      <div class="mce-expert-review-form-field"><select id="mce-expert-review-expert-experts"></select></div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-users" style="display: none;">      <label class="mce-expert-review-form-label" for="mce-expert-review-expert-users">Пользователь</label>      <div class="mce-expert-review-form-field"><select id="mce-expert-review-expert-users"></select></div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-description">      <label class="mce-expert-review-form-label" for="mce-expert-review-expert-description">Описание</label>      <div class="mce-expert-review-form-field"><input id="mce-expert-review-expert-description" type="text"></div>    </div>    <div class="mce-expert-review-form js-mce-expert-review-expert-show-button">      <div class="mce-expert-review-form-label">Задать вопрос</div>      <div class="mce-expert-review-form-field"><label><input type="checkbox" checked> Показать кнопку</label></div>    </div>  <div class="mce-expert-review-form js-mce-expert-review-qa-show-type">    <label class="mce-expert-review-form-label" for="mce-expert-review-qa-show-type">Задать вопрос - действие</label>    <div class="mce-expert-review-form-field">      <select id="mce-expert-review-qa-show-type">        <option value="popup">Попап</option>        <option value="comments">Коментарии</option>      </select>    </div>  </div>  <div class="mce-expert-review-form js-mce-expert-review-expert-show-title">    <div class="mce-expert-review-form-label">Показать заголовок</div>    <div class="mce-expert-review-form-field"><label><input type="checkbox"> Показать</label></div>  </div>  <div class="mce-expert-review-form js-mce-expert-review-expert-title">    <label class="mce-expert-review-form-label" for="mce-expert-review-expert-title">Заголовок</label>    <div class="mce-expert-review-form-field"><input id="mce-expert-review-expert-title" type="text"></div>  </div>  <div class="mce-expert-review-expert-text js-mce-expert-review-expert-text">    <textarea placeholder="Текст (если нужен)"></textarea>  </div>  </div>\x3c!--.mce-expert-review-expert--\x3e  </div>\x3c!--.mce-expert-review-section--\x3e  <div class="mce-expert-review-header js-mce-expert-review-header">Вопросы и ответы</div>  <div class="mce-expert-review-section js-mce-expert-review-section">  <div class="mce-expert-review-qa">    <div class="mce-expert-review-qa-list js-mce-expert-review-qa-list">      <div class="mce-expert-review-qa-item js-mce-expert-review-qa-item">        <textarea placeholder="Вопрос"></textarea>        <textarea placeholder="Ответ"></textarea>        <div class="mce-expert-review-qa-remove"><span class="js-mce-expert-review-qa-remove">&times;</span></div>      </div>    </div>    <div><button type="button" class="button js-mce-expert-review-qa-add">Добавить</button></div>  </div>\x3c!--.mce-expert-review-qa--\x3e  <div class="mce-expert-review-form js-mce-expert-review-qa-show-title">    <div class="mce-expert-review-form-label">Показать заголовок</div>    <div class="mce-expert-review-form-field"><label><input type="checkbox" checked> Показать</label></div>  </div>  <div class="mce-expert-review-form js-mce-expert-review-qa-title">    <label class="mce-expert-review-form-label" for="mce-expert-review-qa-title">Заголовок</label>    <div class="mce-expert-review-form-field"><input id="mce-expert-review-qa-title" type="text"></div>  </div>  </div>\x3c!--.mce-expert-review-section--\x3e  <div class="mce-expert-review-header js-mce-expert-review-header">Рейтинг</div>  <div class="mce-expert-review-section js-mce-expert-review-section">  <div class="mce-expert-review-score">    <div class="mce-expert-review-score-lines js-mce-expert-review-score-lines">      <div class="mce-expert-review-score-line js-mce-expert-review-score-line">        <div class="mce-expert-review-score-line-name js-mce-expert-review-score-line-name"><input type="text"></div>        <div class="mce-expert-review-score-line-score js-mce-expert-review-score-line-score"><input type="number" min="0" step="0.1"></div>        <div class="mce-expert-review-score-line-remove"><span class="js-mce-expert-review-score-line-remove">&times;</span></div>      </div>    </div>    <div><button type="button" class="button js-mce-expert-review-score-line-add">Добавить</button></div>  </div>  <div class="mce-expert-review-summary-text js-mce-expert-review-summary-text">    <textarea placeholder="Итоговый текст (если нужен)"></textarea>  </div>  <div class="mce-expert-review-form js-mce-expert-review-summary-average">    <div class="mce-expert-review-form-label">Итоговая оценка</div>    <div class="mce-expert-review-form-field"><label><input type="checkbox" checked> Показать</label></div>  </div>  <div class="mce-expert-review-form mce-expert-review-score-max js-mce-expert-review-score-max">    <label class="mce-expert-review-form-label" for="mce-expert-review-score-max">Максимум баллов</label>    <div class="mce-expert-review-form-field"><input id="mce-expert-review-score-max" type="number" min="0"></div>  </div>  <div class="mce-expert-review-form mce-expert-review-score-symbol js-mce-expert-review-score-symbol">    <label class="mce-expert-review-form-label" for="mce-expert-review-score-symbol">Символ</label>    <div class="mce-expert-review-form-field"><input id="mce-expert-review-score-symbol" type="text"><p class="description">% или /{{max}} для вывода например 45/100</p></div>  </div>  </div>\x3c!--.mce-expert-review-section--\x3e  <div class="mce-expert-review-header js-mce-expert-review-header">Плюсы и минусы</div>  <div class="mce-expert-review-section js-mce-expert-review-section">  <div class="mce-expert-review-pluses-minuses">    <div class="mce-expert-review-pluses">      <div class="mce-expert-review-pluses-container js-mce-expert-review-pluses-minuses-container">        <div class="mce-expert-review-plus js-mce-expert-review-plus">          <input type="text" placeholder="+"> <span class="mce-expert-review-plus-minus-remove js-mce-expert-review-plus-minus-remove">&times;</span>        </div>      </div>      <div><button type="button" class="button js-mce-expert-review-plus-minus-add">Добавить</button></div>    </div>    <div class="mce-expert-review-minuses">      <div class="mce-expert-review-minus-container js-mce-expert-review-pluses-minuses-container">        <div class="mce-expert-review-minus js-mce-expert-review-minus">          <input type="text" placeholder="–"> <span class="mce-expert-review-plus-minus-remove js-mce-expert-review-plus-minus-remove">&times;</span>        </div>      </div>      <div><button type="button" class="button js-mce-expert-review-plus-minus-add">Добавить</button></div>    </div>  </div>  <div class="mce-expert-review-form js-mce-expert-review-plus-minus-show-title">    <div class="mce-expert-review-form-label">Показать заголовок</div>    <div class="mce-expert-review-form-field"><label><input type="checkbox" checked> Показать</label></div>  </div>  <div class="mce-expert-review-form js-mce-expert-review-plus-minus-title">    <label class="mce-expert-review-form-label" for="mce-expert-review-plus-minus-title">Заголовок</label>    <div class="mce-expert-review-form-field"><input id="mce-expert-review-plus-minus-title" type="text"></div>  </div>  </div>\x3c!--.mce-expert-review-section--\x3e</div>\x3c!--.mce-expert-review--\x3e';t.windowManager.open({title:"Expert Review",html:c,width:600,height:i,buttons:[{text:"OK",subtype:"primary",onclick:function(){var r="[expert_review",i=e(".js-mce-expert-review-type").val();switch(r+=' expert_type="'+i+'"',i){case"self":var c=e(".js-mce-expert-review-expert-avatar input").val();c.length>0&&(r+=' expert_avatar="'+c+'"');var s=e(".js-mce-expert-review-expert-name input").val();s.length>0&&(r+=' expert_name="'+s+'"');break;case"user_id":r+=' expert_id="'+e(".js-mce-expert-review-expert-users select").val()+'"';break;case"expert_id":r+=' expert_id="'+e(".js-mce-expert-review-expert-experts select").val()+'"'}var p=e(".js-mce-expert-review-expert-description input").val();p.length>0&&(r+=' expert_description="'+v(p,!1)+'"'),e(".js-mce-expert-review-expert-show-button input").prop("checked")||(r+=' expert_show_button="0"');var l=e(".js-mce-expert-review-expert-text textarea").val();l.length>0&&(r+=' expert_text="'+v(l)+'"'),e(".js-mce-expert-review-expert-show-title input").prop("checked")&&(r+=' expert_show_title="1"');var a=e(".js-mce-expert-review-expert-title input").val();a.length>0&&(r+=' expert_title="'+v(a,!1)+'"');var o="";e(".js-mce-expert-review-qa-item").each((function(){var r=e(this),t=r.find("textarea:first").val(),i=r.find("textarea:last").val();o.length>0&&(o+=";;"),o+=v(t),i.length>0&&(o+="::",o+=v(i))})),o.length>0&&(r+=' qa_data="'+o+'"'),e(".js-mce-expert-review-qa-show-title input").prop("checked")||(r+=' qa_show_title="0"');var m=e(".js-mce-expert-review-qa-title input").val();m.length>0&&(r+=' qa_title="'+v(m,!1)+'"'),r+=' qa_type="'+e(".js-mce-expert-review-qa-show-type select").val()+'"';var n="";e(".js-mce-expert-review-score-line").each((function(){var r=e(this),t=r.find(".js-mce-expert-review-score-line-name input").val(),i=r.find(".js-mce-expert-review-score-line-score input").val();n.length>0&&(n+=";;"),n+=v(t,!1),i.length>0&&(n+="::",n+=i)})),n.length>0&&(r+=' score_data="'+n+'"');var x=e(".js-mce-expert-review-summary-text textarea").val();x.length>0&&(r+=' score_summary_text="'+v(x)+'"'),e(".js-mce-expert-review-summary-average input").prop("checked")||(r+=' score_summary_average="0"');var d=e(".js-mce-expert-review-score-max input").val();d>0&&(r+=' score_max="'+d+'"');var w=e(".js-mce-expert-review-score-symbol input").val();w&&(r+=' score_symbol="'+w+'"');var u="";e(".js-mce-expert-review-plus input").each((function(){var r=e(this).val();u.length>0&&(u+=";;"),u+=v(r,!1)})),u.length>0&&(r+=' pluses="'+u+'"');var f="";e(".js-mce-expert-review-minus input").each((function(){var r=e(this).val();f.length>0&&(f+=";;"),f+=v(r,!1)})),f.length>0&&(r+=' minuses="'+f+'"'),e(".js-mce-expert-review-plus-minus-show-title input").prop("checked")||(r+=' pluses_minuses_show_title="0"');var h=e(".js-mce-expert-review-plus-minus-title input").val();h.length>0&&(r+=' pluses_minuses_title="'+v(h,!1)+'"');var j=e(".js-mce-expert-review-color-field").val();j.length||(j="purple-1"),r+=' color="'+j+'"',r+="]",t.execCommand("mceInsertContent",0,r),tinymce.activeEditor.windowManager.close()}},{text:"Отмена",onclick:"close"}]})}})},createControl:function(e,r){return null},getInfo:function(){return{longname:"Expert Review",author:"WPShop.ru",version:"1.0.0"}}}),tinymce.PluginManager.add("expert_review_button",tinymce.plugins.expert_review_button)}))}));